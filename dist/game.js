!function t(e,r,n){function o(a,u){if(!r[a]){if(!e[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var s=r[a]={exports:{}};e[a][0].call(s.exports,function(t){var r=e[a][1][t];return o(r?r:t)},s,s.exports,t,e,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function u(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,u)}c((n=n.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,i=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){u.label=r[1];break}if(6===r[0]&&u.label<a[1]){u.label=a[1],a=r;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(r);break}a[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}};Object.defineProperty(r,"__esModule",{value:!0});var i,a=t("./utils");!function(t){t[t.EMPTY=0]="EMPTY",t[t.PLAYER_1=1]="PLAYER_1",t[t.PLAYER_2=2]="PLAYER_2",t[t.DRAW=3]="DRAW"}(i=r.BoardPiece||(r.BoardPiece={}));var u=function(){function t(e){this.map=[];for(var r=0;r<t.row;r++){this.map.push([]);for(var n=0;n<t.column;n++)this.map[r].push(i.EMPTY)}this.canvas=e,this.context=e.getContext("2d")}return t.prototype.applyPlayerAction=function(e,r){return n(this,void 0,void 0,function(){var n,a,u;return o(this,function(o){switch(o.label){case 0:if(this.map[0][r]!==i.EMPTY||r<0||r>=t.column)return[2,!1];for(n=!1,a=0,u=0;u<t.row-1;u++)if(this.map[u+1][r]!==i.EMPTY){n=!0,a=u;break}return n||(a=t.row-1),[4,this.animateAction(a,r,e.boardPiece)];case 1:return o.sent(),this.map[a][r]=e.boardPiece,this.debug(),[2,!0]}})})},t.prototype.debug=function(){console.log(this.map.map(function(t){return t.join(" ")}).join("\n"))},t.prototype.getWinner=function(){for(var e=this,r=[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]],n=function(r,o,i,a,u){return u>=4||!(r<0||o<0||r>=t.row||o>=t.column||e.map[r][o]!==i)&&n(r+a[0],o+a[1],i,a,u+1)},o=0,a=0;a<t.row;a++)for(var u=0;u<t.column;u++){var c=this.map[a][u];if(c!==i.EMPTY)for(var l=0;l<r.length;l++){var s=n(a+r[l][0],u+r[l][1],c,r[l],1);if(s)return c}else o++}return 0===o?i.DRAW:i.EMPTY},t.prototype.getPlayerColor=function(t){switch(t){case i.PLAYER_1:return"#ff4136";case i.PLAYER_2:return"#0074d9";default:return"transparent"}},t.prototype.animateAction=function(t,e,r){return n(this,void 0,void 0,function(){var i,u,c,l=this;return o(this,function(s){switch(s.label){case 0:i=this.getPlayerColor(r),u=0,c=function(){return n(l,void 0,void 0,function(){return o(this,function(t){return a.Utils.clearCanvas(this),a.Utils.drawCircle(this.context,{x:75*e+100,y:u+50,r:25,fill:i,stroke:"black"}),this.render(),u+=25,[2]})})},s.label=1;case 1:return 75*t>=u?[4,a.Utils.animationFrame()]:[3,3];case 2:return s.sent(),c(),[3,1];case 3:return[2]}})})},t.prototype.render=function(){a.Utils.drawMask(this);var e,r;for(r=0;r<t.row;r++)for(e=0;e<t.column;e++)a.Utils.drawCircle(this.context,{x:75*e+100,y:75*r+50,r:25,fill:this.getPlayerColor(this.map[r][e]),stroke:"black"})},t}();u.row=6,u.column=7,r.Board=u},{"./utils":6}],2:[function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function u(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,u)}c((n=n.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,i=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){u.label=r[1];break}if(6===r[0]&&u.label<a[1]){u.label=a[1],a=r;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(r);break}a[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}};Object.defineProperty(r,"__esModule",{value:!0});var i=t("./board"),a=t("./player-human"),u=t("./player-ai"),c=function(){function t(){this.board=new i.Board(document.querySelector("canvas")),this.players=[new a.PlayerHuman(i.BoardPiece.PLAYER_1,this.board),new u.PlayerAi(i.BoardPiece.PLAYER_2)],this.currentPlayerId=0,this.isMoveAllowed=!1,this.isGameWon=!1,this.board.render(),this.board.debug()}return t.prototype.start=function(){return n(this,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:this.isMoveAllowed=!0,e.label=1;case 1:return this.isGameWon?[3,3]:[4,this.move()];case 2:return e.sent(),t=this.board.getWinner(),t!==i.BoardPiece.EMPTY?(console.log("Game over: winner is player ",t),this.isGameWon=!0,this.isMoveAllowed=!1,[3,3]):[3,1];case 3:return[2]}})})},t.prototype.move=function(){return n(this,void 0,void 0,function(){var t,e,r;return o(this,function(n){switch(n.label){case 0:if(!this.isMoveAllowed)return[2];t=this.players[this.currentPlayerId],e=!1,n.label=1;case 1:return e?[3,4]:[4,t.getAction(this.board)];case 2:return r=n.sent(),this.isMoveAllowed=!1,[4,this.board.applyPlayerAction(t,r)];case 3:return e=n.sent(),this.isMoveAllowed=!0,e||console.log("Move not allowed! Try again."),[3,1];case 4:return this.currentPlayerId=this.getNextPlayer(),[2]}})})},t.prototype.getNextPlayer=function(){return 0===this.currentPlayerId?1:0},t}();r.Game=c;var l=new c;l.start()},{"./board":1,"./player-ai":3,"./player-human":4}],3:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function u(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,u)}c((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,i=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){u.label=r[1];break}if(6===r[0]&&u.label<a[1]){u.label=a[1],a=r;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(r);break}a[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}};Object.defineProperty(r,"__esModule",{value:!0});var a=t("./player"),u=t("./utils"),c=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.getAction=function(t){return o(this,void 0,void 0,function(){return i(this,function(t){return[2,u.Utils.getRandomColumnNumber()]})})},e}(a.Player);r.PlayerAi=c},{"./player":5,"./utils":6}],4:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function u(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,u)}c((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,i=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){u.label=r[1];break}if(6===r[0]&&u.label<a[1]){u.label=a[1],a=r;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(r);break}a[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}};Object.defineProperty(r,"__esModule",{value:!0});var a=t("./player"),u=t("./utils"),c=function(t){function e(e,r){var n=t.call(this,e)||this;return n.clickPromiseResolver=null,n.board=r,document.addEventListener("click",function(t){try{n.handleClick(t)}catch(t){console.error(t)}}),n}return n(e,t),e.prototype.handleClick=function(t){var e=this.board.canvas.getBoundingClientRect(),r=t.clientX-e.left,n=t.clientY-e.top,o=u.Utils.getColumnFromCoord({x:r,y:n});this.clickPromiseResolver(o)},e.prototype.getAction=function(t){return o(this,void 0,void 0,function(){var t=this;return i(this,function(e){return[2,new Promise(function(e){return t.clickPromiseResolver=e})]})})},e}(a.Player);r.PlayerHuman=c},{"./player":5,"./utils":6}],5:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t){this.boardPiece=t}return t}();r.Player=n},{}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./board"),o=function(){function t(){}return t.drawCircle=function(t,e){var r=e.x,n=void 0===r?0:r,o=e.y,i=void 0===o?0:o,a=e.r,u=void 0===a?0:a,c=e.fill,l=void 0===c?"":c,s=e.stroke,f=void 0===s?"":s;t.save(),t.fillStyle=l,t.strokeStyle=f,t.beginPath(),t.arc(n,i,u,0,2*Math.PI,!1),t.fill(),t.restore()},t.drawMask=function(t){var e=t.context;e.save(),e.fillStyle="#ddd",e.beginPath();var r,o;for(o=0;o<n.Board.row;o++)for(r=0;r<n.Board.column;r++)e.arc(75*r+100,75*o+50,25,0,2*Math.PI),e.rect(75*r+150,75*o,-100,100);e.fill(),e.restore()},t.clearCanvas=function(t){t.context.clearRect(0,0,t.canvas.width,t.canvas.height)},t.isCoordOnColumn=function(t,e,r){return(t.x-e)*(t.x-e)<=r*r},t.getColumnFromCoord=function(e){for(var r=0;r<n.Board.column;r++)if(t.isCoordOnColumn(e,75*r+100,25))return r;return-1},t.getRandomColumnNumber=function(){return Math.floor(Math.random()*n.Board.column)},t.animationFrame=function(){var t=null,e=new Promise(function(e){return t=e});return window.requestAnimationFrame(t),e},t}();r.Utils=o},{"./board":1}]},{},[2]);
//# sourceMappingURL=game.js.map
