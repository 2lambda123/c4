{"version":3,"sources":["player-human-flyweb.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,+CAA4C;AAK5C;IAAuC,qCAAW;IAIhD,2BAAY,UAAsB,EAAE,MAAyB;QAA7D,YACE,kBAAM,UAAU,EAAE,MAAM,CAAC,SAE1B;QANQ,cAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;QAC5F,aAAO,GAAe,SAAS,CAAC;QAIvC,KAAI,CAAC,UAAU,EAAE,CAAA;;IACnB,CAAC;IACK,iCAAK,GAAX,UAAY,GAAuB,EAAE,GAAY;;0BAEzC,WAAW,QAEX,OAAO;;;4BAHI,qBAAM,KAAK,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,EAAA;;mCAAhC,SAAgC;sCAC7B,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC;wBAC3C,qBAAM,QAAQ,CAAC,IAAI,EAAE,EAAA;;+BAArB,SAAqB;kCAClB,EAAE,cAAc,EAAE,WAAW,EAAE;wBAE/C,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,GAAG,CAAC,CAAA;wBACjC,GAAG,CAAC,WAAW,CAAC,IAAI,OAAO,CAAW,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,QAAQ,CAAC,IAAI,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,EAAlC,CAAkC,CAAC,CAAC,CAAA;;;;;KAChF;IACK,sCAAU,GAAhB;;;;;;;wBACE,EAAE,CAAC,CAAC,CAAC,CAAC,eAAe,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;4BACvC,MAAM,CAAC,KAAK,CAAC,+EAA+E,CAAC,CAAA;4BAC7F,MAAM,gBAAC,KAAK,EAAA;wBACd,CAAC;wBACc,qBAAM,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,mBAAmB,CAAC,EAAA;;iCAArD,SAAqD;wBACpE,MAAM,CAAC,OAAO,GAAG,UAAO,GAAsB;gCACxC,QAAQ,EAER,GAAG,EACH,MAAM;;2CAHK,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC;sCAE/B,QAAQ,CAAC,CAAC,CAAC;yCACR,IAAI,eAAe,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gCAC7C,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,GAAG,EAAE,MAAM,CAAC,CAAA;gCAE/C,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;oCACZ,KAAK,eAAe;wCAClB,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,sBAAsB,CAAC,CAAA;wCACvC,KAAK,CAAC;oCACR,SAAS,CAAC;wCACR,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;oCACtB,CAAC;gCACH,CAAC;;;6BACF,CAAA;;;;;KACF;IACH,wBAAC;AAAD,CAxCA,AAwCC,CAxCsC,0BAAW,GAwCjD;AAxCY,8CAAiB","file":"player-human-flyweb.js","sourcesContent":["/**\r\n * EXPERIMENTAL\r\n * Based on flyweb example \"photo-wall\"\r\n * 2-player not achievable yet, FlyWeb clients currently could play locally with AI :P\r\n * TODO:\r\n * Client should have:\r\n * - \"Player\" that acts as message receiver showing Server moves\r\n * - Real human player, clicking, etc. and send message to server\r\n * Server should have:\r\n * - \"Player\" that acts as message receiver showing Client moves\r\n * - Real human player, clicking, etc. and broadcast message to client\r\n */\r\nimport { PlayerHuman } from './player-human'\r\nimport { BoardPiece } from './board';\r\nimport { INavigator } from './player-human-flyweb-utils/Navigator';\r\nimport { IFlyWebFetchEvent } from './player-human-flyweb-utils/FlyWeb';\r\n\r\nexport class PlayerHumanFlyweb extends PlayerHuman {\r\n  readonly BASE_URL = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));\r\n  readonly browser = <INavigator>navigator;\r\n\r\n  constructor(boardPiece: BoardPiece, canvas: HTMLCanvasElement) {\r\n    super(boardPiece, canvas)\r\n    this.initServer()\r\n  }\r\n  async fetch(evt : IFlyWebFetchEvent, url : string) {\r\n    const response = await fetch(this.BASE_URL + url)\r\n    const contentType = response.headers.get('Content-Type')\r\n    const blob = await response.blob()\r\n    const headers = { 'Content-Type': contentType }\r\n    // TODO add no cache header please\r\n    console.log('Response is: ', url)\r\n    evt.respondWith(new Promise<Response>(r => r(new Response(blob, { headers }))))\r\n  }\r\n  async initServer() {\r\n    if (!('publishServer' in this.browser)) {\r\n      window.alert('FlyWeb requires Firefox Developer Edition and enabling a flag at about:config')\r\n      return false\r\n    }\r\n    const server = await this.browser.publishServer('c4 - Connect Four')\r\n    server.onfetch = async (evt: IFlyWebFetchEvent) => {\r\n      var urlParts = evt.request.url.split('?');\r\n\r\n      var url = urlParts[0];\r\n      var params = new URLSearchParams(urlParts[1]);\r\n      console.log('Requested for url: ', url, params)\r\n\r\n      switch (url) {\r\n        case '/dist/game.js':\r\n          this.fetch(evt, '/dist/game-client.js')\r\n          break;\r\n        default: {\r\n          this.fetch(evt, url)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}